package com.drinkscabinet.aoc2020

import GridString
import com.drinkscabinet.Coord

private fun main() {
    val monster = GridString.parse(seaMonster.replace(" ", "."))
    println(monster.toString(true))

    val monsters = mutableListOf<GridString>()
    for (i in 0..3) {
        monsters.add(monster.copyOf().rotate90(i).normalise())
    }
    for (i in 0..3) {
        monsters.add(monster.copyOf().flipH().rotate90(i).normalise())
    }

    // Now the grid
    val grid = GridString.parse(input)
    val activeGridCells = grid.getAll('#')
    // For every position in the grid
    for (x in grid.getXMin() - 20..grid.getXMax() + 20) {
        for (y in grid.getYMin() - 20..grid.getYMax() + 20) {
            // try all the monsters
            val c = Coord(x, y)
            for (monster in monsters) {
                // reposition the monster to this point
                val toTest = monster.copyOf().translate(c)
                // Now test if all the monster cells are in
                val activeMonsterCells = toTest.getAll('#')
                if (activeGridCells.containsAll(activeMonsterCells)) {
                    println("Found monster at $c")
                    // replace the found monster cells with 'O'
                    activeMonsterCells.forEach { grid.add(it, 'O') }
                }
            }
        }
    }

    println(grid.toString(true))
    // At the end count how many still active
    val stillActive = grid.getAll('#')
    println(stillActive.size)

    // 2032 too high
    // 1957 correct
    // why did rotating it work?
    // Needed to start outside the bounds with the monster - must have been one on the edge

}


private val seaMonster = """
                  # 
#    ##    ##    ###
 #  #  #  #  #  #       
"""


private val testInput = """
    .#.#..#.##...#.##..#####
    ###....#.#....#..#......
    ##.##.###.#.#..######...
    ###.#####...#.#####.#..#
    ##.#....#.##.####...#.##
    ...########.#....#####.#
    ....#..#...##..#.#.###..
    .####...#..#.....#......
    #..#.##..#..###.#.##....
    #.####..#.####.#.#.###..
    ###.#.#...#.######.#..##
    #.####....##..########.#
    ##..##.#...#...#.#.#.#..
    ...#..#..#.#.##..###.###
    .#.#....#.##.#...###.##.
    ###.#...#..#.##.######..
    .#.#.###.##.##.#..#.##..
    .####.###.#...###.#..#.#
    ..#.#..#..#.#.#.####.###
    #..####...#.#.#.###.###.
    #####..#####...###....##
    #.##..#..#...#..####...#
    .#.###..##..##..####.##.
    ...###...##...#...#..###
""".trimIndent()


private val input = """
    ...#..........#....#..........#.##..#........##.###.........#.#.#........................#...#.#
    ..#..#........#.#....#....#............#.........#..#...#.#......#.#....#..#.#...#...#..........
    ....#....###..#....#...#.##.....#.#.....#........#.##....##.#..#..#....##..#.#.....#.....#...#.#
    ..####.................#.......##...#..#....#............#....#........#.#....#.#........####...
    .##.#......#....#..##..###.........#..###...##.....#......#.......#...#.##.#........#....#......
    #.##.....#..#..#....#..#....#...##...#.#...##...#..........#.###.#...#........#.........#..#..##
    ....#...##....#.......##......#####...##...#.....#..#.#...#..#.###...#..#.#..#..#.#.......#..#..
    ....##...........#....##.....#..##.#.#......#.##..#..#.#..#....#......#.......##...#.#..###.#..#
    ...#....#................#.....#.#.#..#.#..........#.#....#...#.........#........##.....#...#...
    ....#...#...#.....#..##......#.#.#....##..##...#..#...##.#....#.#...##..##.#.....##....#.#..##..
    #.#.#.#......##......###....#.#.....#..#....#.#......#..#.......#...#...#.#.#......#..#..#.....#
    .#.#.#...#.............##..##..#.....#.##...##..##.#..#.###...#..#.....##.#.....#.......#..##.#.
    #.......###.###.......##.......##.#.#.#...##....#....#...##.##.##.#.##...#....#.###....#....#.#.
    ....#.#.#.##...#...#......###..##.#.#.......#..#.#.#........#..#...#..#..........#...#..........
    .###.###..#.........#........#.#......#..#..##........#......##........#...##.###.......##..#.#.
    ...###..###..........##.#..#.####..#..###..#...#..#....#......#....#..#.#..##......#.#...#..#...
    ....#...........#.#....#........#.#...##....#....###.#...........##.....#.....#...#...#..#..#.#.
    .#.##.........#...#....#.......#...#...#....##.#.###.#.....#.##...#...##.#..............###.##..
    .........##....#.###..#.........#....###...#.#...#........##...##..#..##.#......#.##.......#.#.#
    ..##..#...#..##...###.#......#..###.....#..##..#......##...#...#.....##...#....#.............###
    .#.#...#..###....#..##.........#......######.........#...#.#..#.#..#...##....#.#....##..##...#.#
    .#..#..#.#.....#.###..#.#.#..##.....#.#....##....#.##.......#..#........#..#....##...###.#.##...
    .............#.#...#..##.#.....####.#.##....#.....#.#..........##......###....#..##...#....#...#
    .#.#..#.#.#.....##......#......#.##........#......#.#.####.##.#.#...#..#.....##.##.#.#.#......#.
    .....###.##..#.#..#...........#.#......#.....#..##...##..#...#.#.#..#...........#...........##.#
    ###..#....#......##.###...##..#........#..#.................#..#.......#.##.##.#...#....#.#..#..
    ........###...#..#...#........#...............##.....#.#...#.....#.....#..#...#.#..#...#.....#..
    ...#.....#..##........#.#..#......#...#.....#....#..#...........#...###.#...#.#.#.......#...##..
    ..#...#..#...#..##....#....##.......#..#...#...#..#..##.............##....#.....###.........##..
    ............##...###.......#.#.....#..#..........##...##.#.....#..#.....#........#..##..#.....##
    #........#....##..##..#...#........#.#......#....#.....###....#..........#......#........####...
    #...#..#..#...#...###...#.#...#.#...#....#.........##..##....##.##.....#.##.....#...#..###...#..
    .##.#.#......#..###......#....###.#...#.....#..#.....##....#...........##.#.....#..........#.#..
    ......#......#...#....##.##.#.#..........#..#.#..##......#..#......#.....#......#...#.##....#...
    ...##.##...............#.#...#.......#.#.......#.##.......#.#........#.......#...#......##......
    .#..#..#.......#.#.....##......##...........##..#..#..#.#.#.##..........#....#...#.#.##.....#...
    #.#.#.............#.......................#.........#..#..#......#.....#....##..##....##....#...
    ..#.#..#.......#..................#....#....#..#.#..#..#.#.......#.##...........#..#......#..#..
    ...#.##.#............#..#.#.#...#....#.#....#..#......#........###..#................#....#...#.
    ...........#....#.##.#.#.#........#............#.#...#....#.........#...#.......#.##.#.#.##..#..
    ........#....#..#..#.....#......#.#...#............#......#.........#..#####.....##.#..###..#.##
    .#..#......#.##...#..#..#.#.#.#.#..........##.........#.#.#...#.#.......#..##.#...#...#.#.......
    .#..###......##........#.#......#.#..#......#..#.#..#.###.#.#.###..##..#.#........##...........#
    ......#....#...##...............###.##..###.....###...##..#...#.#....##.........#...........###.
    ....####..#.#......#....##..#......#..#.#.....#..#....#.##.#.#..#....#..#....#.#.###......#..##.
    ......##..#....#........##................#.....#.#.##.##.#....##..#...#...#.......#..#.#....##.
    ..##.#...#...#...........#.#....##......#.....#.....##........#...#.#.#.#.......###......#......
    .......###.....#.#....#.#........#.#.#...####..#..##.###....#...#.#...#.#.....##....#...#.#.....
    ##.#.......#....#.........##........###.#.....###..#...###.#.......##.##.#..#...#...............
    .#..##...................###.........#...##.#...##........#..............####....#.##....#.#..#.
    ......#.#..#...#......####...#.#..#.#..#####.....####......##.........#......#..#........#......
    ...#.###............#....#..#...#......#..##..#.#..............#.###...#.#.........#..#.#..##...
    .#.#.##...##....#..#.#.#..............#..#.#.#.......................##.#..#..##....###....#..#.
    ......#.....#...........#..#......#.###...............#...#.#........#..#....#.............###..
    .....##..#............#..##.#...#....##.....##..#...#......##....##....#.......#...#.#.#...#....
    ###..#.....#......#.........##..#...###..#..#..#.##..#........#.#.......#..##...#...#.....#..#..
    #..#..#...#.........#...#...##..##..#.##..#...#..#..#.#..#.....##...##.....#..#.##..#....#...#..
    ....#.#..#...#.#....#.......###.##.#.#..#.##...##.....#.#..........##..#.#....#.....###......#..
    ....##....#.........###.#......##...##...#...#......#......#.........##.##.#.....####...#.#.##..
    #.........##....#..##..........##..##..#.#....##.......#..#..#......###.#..###.#.#.##....#.##.#.
    ...#..#......##....#.##..............#.#........##.##.#........#..#.#..#....#..#...........#.#..
    .....#..##.#........##..#.##...#.....#...#...#..##...#..#.............#.##.......#.#....#.##....
    .....##.#...#.#......#..........#...#.#...#....#...#..#.........##...#...#.#....#.##.##..#....#.
    .#...#....#...##...#.#.#....#.#.#......#..#.....#....#........#..##....#........#.###.#..#..#.##
    .#.#..#.#.....#.....#.....#....#.##.##...#........###.........#..#.##..........#....#...#.#..#..
    ###..#...#...#....#.#...............#.......................#..###..........#..##.##.......#....
    ...#..#..#..##.....#...#....#...###..#.#......#.##....#..#....#.#...#....#...####.....#...##..#.
    #.#..#...##.#####.#.#...#...##.#.##.#.#..#.......##.#.....###.......#.#......##.##..##....#...#.
    .#..#.......##.#...#.........#..#...#.....##...........#.#......#......#....##....##....##....##
    .#..##.#.#.####....#...##.#.#...#....###.#....#.#......#.##......##....#........#...##..........
    #...#...###...#.....##....#..#.#...#...#....##......#.##.##......#.#.#..##....#.....##....#..#..
    ...##.##.#...#...##.#.....#.#.....###......#..#..#......#......##......#....##.##.####.#.#.#....
    ...#....#....#..#..#.......#.#...............####.#........#.#.......#.........#.......##..#..##
    .....#.#..#.....#.......##.#..##.#............#..#........#....#.#......#...#.##.......#..#.....
    ...#..#......#..#...#.....#...#.#.#..........#...#...#.##.....###.#.....##......#..#...###.#....
    ....###.#..##.#....#...#.....##...#...#.##...#........#..#.......#..#...##.##....#..#...#.#.#...
    ....#..#.##...#.#...#..#...#.....#....##..#..............#.#.....#.#...#..#...#....#...........#
    ..##.....#...#...##..#.##....#.......##..##..##.#####...##.##...##.#.#..#..#...##......###......
    .......###...#..#.#......##....#.#..###.##.#..###..##.......#.....##....##.....#....#...#.......
    ...............#.............#.........#.#..#.#......#.##...#..........#......##....#....#...#..
    #..#.....#...#.#........#............####.####.#....#..##.......#.....###.....##...###..#.......
    ..###.#.#.....#....#.....#.....##....#.....#.........#...#..#....#.....###....#..####...........
    ....#....#..#...#.#...........#.......##..#......##...#..#..#.#......#.#..##.##.....#........##.
    ..##.#..##......#....#...##....#.#..#.#...#..#....#.#..##....#....#.#.##....#..##..#..##....#..#
    #.#.....###.#.#....#...#..#..#..#....#..#.....##..#.#..#.###....#...#............#..##..#....#..
    ...#.....##...#...#....#....#.............#...##.....##...........###..#......##....##.#......##
    ...#........#.#.####........#.....#....#..##.#.#...#..#.#.........##....#.....#...#..#.#.....#..
    ..#.#...##.#.....##.........##......##...##....#...#.....#....####...#..#...##..#.......##...##.
    #....#...##............#..#....#.#.#..##.##....#....#.##..#.#...##.....##...#.......#......#....
    ..###....#.##...#....................###..##.#..#..#.....#..#......##...#.....#.................
    ..#..###.#..#.#....#.#..#.##.#.#..#..##..#..#.#....#.#....#..#..#............#.........#.....#..
    .#..#.#............#..........#.#.#.#....#.....##..............#.......##......#....#.#.........
    .......#........................#.....###.....#....###.#..##.......#....##................#.....
    ........#...#...........#......###..##.#.#....#.....#.#.#....#.......#...#...........##.....#...
    #.##.##....#..#.#....#..##...#..#.....#..........#.#..##..#........##......#....#.##..#....#.#..
    ...........#.##...#.#...##..#.......#......#.........##.......#.......#............#.....#..#...
""".trimIndent()